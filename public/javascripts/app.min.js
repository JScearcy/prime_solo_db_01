$(document).ready(function(){function a(){$.ajax({method:"GET",url:"/users/refresh"}).done(function(a){$users=$allUsers,$users.empty(),a.forEach(function(a,b){$userDiv=$("<div>").addClass("user"),$userUl=$("<ul>").addClass("list-group"),$userLiUser=$("<li>").addClass("list-group-item"),$userLiName=$("<li>").addClass("list-group-item"),$userLiEmail=$("<li>").addClass("list-group-item"),$userAEmail=$("<a>"),$userLiUser.text("Username: "+a.username),$userLiName.text("Name: "+a.firstname+" "+a.lastname),$userAEmail.attr({href:"mailto:"+a.email}).text("Email "+a.firstname),$userDiv.append($userUl.append($userLiName).append($userLiUser).append($userLiEmail.append($userAEmail))),$users.append($userDiv)}),console.log(a)}).fail(function(a){console.log(a)}).always(function(){})}$allUsers=$(".allusers"),$("#refreshBtn").on("click",function(){a()}),$("#logOut").on("click",function(){$.ajax({method:"GET",url:"/users/logout"}).done(function(a){var b=document.open("text/html","replace");b.write(a),b.close()})}),$("#register").submit(function(a){a.preventDefault(),$("#password").val()===$("#password_confirmation").val()?$(this).ajaxSubmit({type:"POST",url:"/register",clearForm:!0,success:function(a){if(console.log(a),"Already exists"==a){var b=$(".usernameInput");b.children("p").length>0?$(".existsAlready").show():($userExistsDiv=$("<div>").addClass("alert alert-error existsAlready"),$userExistsA=$("<a>").attr({"class":"close",href:"#","data-dismiss":"alert"}).text("x"),$userExistsP=$("<p>").text("Username already exists"),b.append($userExistsDiv.append($userExistsA).append($userExistsP)))}else $("#Register").modal("hide"),$("#userInput").val(a),$("#LoginForm").prepend("<p>Registration Successful!")}}):$(".matchPassword").removeClass("hidden")}),$allUsers.on("click","#subBrews",function(a){a.preventDefault();var b={username:$(".brewnoteform").data("id"),brew:$("#brew").val(),brewnotes:$("#brewnotes").val()};$("#brew").val(""),$("#brewnotes").val(""),$.ajax({method:"POST",url:"/users/post",data:b}).done(function(a){var b=$("#NewBeerPost").html(),c=Handlebars.compile(b);$(".allposts").append(c(a)),console.log(a)})}),$allUsers.on("click","#delPost",function(a){var b=$(this);a.preventDefault();var c={id:$(b).parent().parent().data("id")};$.ajax({method:"DELETE",url:"/users/deletepost",data:c}).done(function(a,c){console.log(c),b.parent().parent().remove()})}),$allUsers.on("click","#editPost",function(a){a.preventDefault();var b=$(this).parent().parent(),c=$(".beerpost"),d=$(".brewnotespost"),e=c.data("brew"),f=d.text(),g=$("<li>"),h=$('<input type="text" id="editedBrew">').val(e),i=$("<li>"),j=$('<textarea rows="3" cols="20" id="editedBrewNotes">').val(f);c.remove(),d.remove(),b.prepend($('<button id="subEdit" class="btn btn-primary">Submit Edit</button>')).prepend(i.append(j)).prepend(g.append(h))}),$allUsers.on("click","#subEdit",function(a){a.preventDefault(),$post=$(this).parent(),$brew=$("#editedBrew");var b={id:$post.data("id"),brew:$("#editedBrew").val(),brewnotes:$("#editedBrewNotes").val()};$.ajax({method:"PUT",url:"/users/editpost",data:b}).done(function(a){console.log(a),$post.remove();var b=$("#NewBeerPost").html(),c=Handlebars.compile(b);$(".allposts").append(c(a))})})});